<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FDE – LOAD 4 Complete Visualiser</title>

<style>
body{
  background:#000;
  font-family:Arial;
  color:white;
  text-align:center;
}

.container{
  width:1200px;
  height:520px;
  margin:20px auto;
  position:relative;
}

/* ================= CPU ================= */

.cpu{
  position:absolute;
  left:50px;
  top:100px;
  width:350px;
  background:#4a6fb3;
  padding:20px;
  border-radius:8px;
}

.reg{
  background:#eee;
  color:black;
  margin:6px;
  padding:6px;
  border-radius:6px;
  font-weight:bold;
}

.unit{
  background:#2ecc71;
  color:black;
  margin:6px;
  padding:8px;
  border-radius:6px;
  font-weight:bold;
}

.highlight{
  box-shadow:0 0 15px #00ffcc;
}

/* ================= MEMORY ================= */

.memory{
  position:absolute;
  right:50px;
  top:100px;
  width:350px;
  background:#e67e22;
  padding:20px;
  border-radius:8px;
  color:black;
}

/* ================= BUSES ================= */

.bus{
  position:absolute;
  left:420px;
  width:360px;
  height:14px;
  border-radius:4px;
}

.addressBus{ top:150px; background:#ff8800; }
.controlBus{ top:190px; background:#cccccc; }
.dataBus{ top:230px; background:#ffd400; }

.busLabel{
  position:absolute;
  left:420px;
  width:360px;
  text-align:center;
  font-weight:bold;
}

.addressLabel{ top:130px; }
.controlLabel{ top:170px; }
.dataLabel{ top:210px; }

.busActive{
  box-shadow:0 0 15px #00ffcc;
}

/* ================= MOVING DATA ================= */

.packet{
  position:absolute;
  background:#00ffcc;
  color:black;
  padding:4px 10px;
  border-radius:6px;
  font-weight:bold;
}

/* ================= CONTROLS ================= */

button{
  margin:10px;
  padding:10px 18px;
  font-size:16px;
}

/* ================= STEP BOX ================= */

#stepBox{
  margin:20px auto;
  width:1000px;
  background:#111;
  padding:20px;
  border-radius:8px;
  text-align:left;
  min-height:140px;
}

#stepHeader{
  font-weight:bold;
  font-size:18px;
}

#stepStage{
  margin-top:8px;
  color:#00ffcc;
}

#stepMicro{
  margin-top:8px;
}

#stepExplain{
  margin-top:12px;
}

</style>
</head>
<body>

<h1>Fetch – Decode – Execute (LOAD 4)</h1>

<div class="container">

<div class="cpu">
  <div class="reg" id="pc">PC = 1</div>
  <div class="reg" id="mar">MAR</div>
  <div class="reg" id="mdr">MDR</div>
  <div class="reg" id="cir">CIR</div>
  <div class="reg" id="acc">ACC = 0</div>
  <div class="unit" id="cu">Control Unit</div>
</div>

<div class="memory">
  <h3>Main Memory</h3>
  <div>1 → LOAD 4</div>
  <div>4 → 5</div>
</div>

<div class="busLabel addressLabel">ADDRESS BUS (CPU → Memory)</div>
<div class="bus addressBus" id="addressBus"></div>

<div class="busLabel controlLabel">CONTROL BUS</div>
<div class="bus controlBus" id="controlBus"></div>

<div class="busLabel dataLabel">DATA BUS (Two-way)</div>
<div class="bus dataBus" id="dataBus"></div>

</div>

<button onclick="nextStep()">Next Step</button>
<button onclick="reset()">Reset</button>

<div id="stepBox">
  <div id="stepHeader">Step 0</div>
  <div id="stepStage"></div>
  <div id="stepMicro"></div>
  <div id="stepExplain"></div>
</div>

<script>

let step=0;
let pc=1;
let acc=0;

function clearHighlights(){
  document.querySelectorAll(".reg, .unit")
    .forEach(el=>el.classList.remove("highlight"));

  document.querySelectorAll(".bus")
    .forEach(el=>el.classList.remove("busActive"));
}

function highlight(id){
  document.getElementById(id).classList.add("highlight");
}

function activateBus(id){
  document.getElementById(id).classList.add("busActive");
}

function sendData(label, busId, direction){

  const bus=document.getElementById(busId);
  activateBus(busId);

  const packet=document.createElement("div");
  packet.className="packet";
  packet.innerText=label;
  packet.style.top = bus.offsetTop - 5 + "px";

  document.querySelector(".container").appendChild(packet);

  let startX = direction === "right" ? 420 : 780;
  let endX   = direction === "right" ? 780 : 420;

  packet.style.left=startX+"px";

  let progress=0;
  let interval=setInterval(()=>{
    progress+=0.03;
    let x=startX+(endX-startX)*progress;
    packet.style.left=x+"px";

    if(progress>=1){
      clearInterval(interval);
      packet.remove();
    }
  },20);
}

const steps=[

{
title:"Step 1",
stage:"FETCH",
micro:"MAR ← PC",
explain:"The PC holds address 1. It is copied into the MAR and sent to memory via the Address Bus.",
exec:()=>{
  clearHighlights();
  highlight("mar");
  document.getElementById("mar").innerText="MAR = 1";
  sendData("1","addressBus","right");
}
},

{
title:"Step 2",
stage:"FETCH",
micro:"READ signal sent",
explain:"The Control Unit sends a READ signal via the Control Bus to request the instruction at address 1.",
exec:()=>{
  clearHighlights();
  highlight("cu");
  sendData("READ","controlBus","right");
}
},

{
title:"Step 3",
stage:"FETCH",
micro:"MDR ← Memory[1]",
explain:"Memory sends LOAD 4 back via the Data Bus. It is stored in the MDR.",
exec:()=>{
  clearHighlights();
  highlight("mdr");
  document.getElementById("mdr").innerText="MDR = LOAD 4";
  sendData("LOAD 4","dataBus","left");
}
},

{
title:"Step 4",
stage:"FETCH",
micro:"CIR ← MDR, PC ← PC + 1",
explain:"The instruction is copied into the CIR. The PC increments to point to the next instruction.",
exec:()=>{
  clearHighlights();
  highlight("cir");
  document.getElementById("cir").innerText="CIR = LOAD 4";
  pc++;
  document.getElementById("pc").innerText="PC = "+pc;
}
},

{
title:"Step 5",
stage:"DECODE",
micro:"Instruction decoded",
explain:"The Control Unit decodes LOAD and identifies operand address 4.",
exec:()=>{
  clearHighlights();
  highlight("cu");
}
},

{
title:"Step 6",
stage:"EXECUTE",
micro:"MAR ← 4",
explain:"Operand address 4 is copied into MAR and sent to memory via the Address Bus.",
exec:()=>{
  clearHighlights();
  highlight("mar");
  document.getElementById("mar").innerText="MAR = 4";
  sendData("4","addressBus","right");
}
},

{
title:"Step 7",
stage:"EXECUTE",
micro:"READ signal sent",
explain:"The Control Unit requests the value stored at address 4.",
exec:()=>{
  clearHighlights();
  highlight("cu");
  sendData("READ","controlBus","right");
}
},

{
title:"Step 8",
stage:"EXECUTE",
micro:"MDR ← Memory[4]",
explain:"Memory returns the value 5 via the Data Bus. It is stored in the MDR.",
exec:()=>{
  clearHighlights();
  highlight("mdr");
  document.getElementById("mdr").innerText="MDR = 5";
  sendData("5","dataBus","left");
}
},

{
title:"Step 9",
stage:"EXECUTE",
micro:"ACC ← MDR",
explain:"The value in the MDR (5) is copied into the Accumulator. LOAD is complete.",
exec:()=>{
  clearHighlights();
  highlight("acc");
  acc=5;
  document.getElementById("acc").innerText="ACC = 5";
}
}

];

function nextStep(){
  if(step < steps.length){
    steps[step].exec();
    document.getElementById("stepHeader").innerText = steps[step].title;
    document.getElementById("stepStage").innerText = "Stage: " + steps[step].stage;
    document.getElementById("stepMicro").innerText = "Micro-operation: " + steps[step].micro;
    document.getElementById("stepExplain").innerText = steps[step].explain;
    step++;
  }
}

function reset(){
  step=0;
  pc=1;
  acc=0;
  clearHighlights();
  document.getElementById("pc").innerText="PC = 1";
  document.getElementById("mar").innerText="MAR";
  document.getElementById("mdr").innerText="MDR";
  document.getElementById("cir").innerText="CIR";
  document.getElementById("acc").innerText="ACC = 0";
  document.getElementById("stepHeader").innerText="Step 0";
  document.getElementById("stepStage").innerText="";
  document.getElementById("stepMicro").innerText="";
  document.getElementById("stepExplain").innerText="";
}

</script>

</body>
</html>