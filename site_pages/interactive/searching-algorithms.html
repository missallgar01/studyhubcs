<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Search Algorithm Step Visualizer</title>
   <link rel="stylesheet" href="../../css/main.css" />

<style>
#arrayWrapper {
  margin: 2rem 0;
  text-align: center;
}

#indexRow, #arrayContainer {
  display: flex;
  justify-content: center;
  gap: 10px;
    color: #000000;
}
.index {
  width: 50px;
  font-weight: bold;
  color: #666;
}
.box {
  width: 50px;
  height: 50px;
  line-height: 50px;
  background: #e0e0e0;
  border-radius: 6px;
  font-weight: bold;
  transition: 0.3s;
}

.current { background: #ffeb3b; }
.checked { background: #ef9a9a; color: white; }
.found { background: #4caf50; color: white; }

.code-line {
  display: block;
  padding: 2px 6px;
}

.highlight-line {
  background: #264f78;
}

#midInfo {
  margin-top: 1rem;
  padding: 1rem;
  border-left: 6px solid orange;
  font-family: monospace;
  display: none;
}
</style>
</head>

<body>

<div class="back-container">
    <a href="../G-booklets.html">‚Üê Back</a>
  </div>
<header>
  <h1>Searching Algorithms</h1>

</header>

<main>
<h1>üîç Search Algorithm Step Visualizer</h1>

<div class="controls">
  <label>Algorithm:</label>
  <select id="searchType">
    <option value="linear">Linear Search</option>
    <option value="binary">Binary Search</option>
  </select>

  <label>Target:</label>
  <input type="number" id="targetInput" placeholder="e.g. 22">

  <button onclick="startSearch()">Start</button>
    <button id="nextBtn" onclick="nextStep()" disabled>Next Step</button>
</div>

<div id="arrayWrapper">
  <div id="indexRow"></div>
  <div id="arrayContainer"></div>
</div>

<div id="midInfo"></div>

<h2>üìä Trace Table</h2>
<table>
  <thead>
    <tr></tr>
  </thead>
  <tbody></tbody>
</table>

<h2>üêç Python Code (Live Execution)</h2>
<pre id="codeBlock"></pre>
</main>
<script>

const array = [3, 7, 10, 21, 22, 25, 27, 30];

let steps = [];
let currentStep = 0;
let searchFinished = false;

const container = document.getElementById("arrayContainer");
const indexRow = document.getElementById("indexRow");
const traceBody = document.querySelector("tbody");
const traceHeader = document.querySelector("thead tr");
const codeBlock = document.getElementById("codeBlock");
const midInfo = document.getElementById("midInfo");

function renderArray() {
  container.innerHTML = '';
  indexRow.innerHTML = '';
  array.forEach((num, i) => {
    const index = document.createElement("div");
    index.className = "index";
    index.textContent = i;
    indexRow.appendChild(index);

    const box = document.createElement("div");
    box.className = "box";
    box.id = "box-" + i;
    box.textContent = num;
    container.appendChild(box);
  });
}

function highlightLine(index) {
  document.querySelectorAll(".code-line").forEach(l => l.classList.remove("highlight-line"));
  const el = document.getElementById("line-" + index);
  if (el) el.classList.add("highlight-line");
}

function highlightBox(index, className) {
  document.querySelectorAll(".box").forEach(b => b.className = "box");
  const el = document.getElementById("box-" + index);
  if (el) el.classList.add(className);
}

function setCode(lines) {
  codeBlock.innerHTML = '';
  lines.forEach((line, i) => {
    const span = document.createElement("span");
    span.className = "code-line";
    span.id = "line-" + i;
    span.textContent = line;
    codeBlock.appendChild(span);
  });
}

function startSearch() {
  const type = document.getElementById("searchType").value;
  const target = parseInt(document.getElementById("targetInput").value);

  if (isNaN(target)) return alert("Enter a target number!");

  steps = [];
  currentStep = 0;
  searchFinished = false;

  renderArray();
  traceBody.innerHTML = '';
  midInfo.style.display = "none";

  if (type === "linear") {
    prepareLinear(target);
  } else {
    prepareBinary(target);
  }

  document.getElementById("nextBtn").disabled = false;
}

function nextStep() {
  if (searchFinished || currentStep >= steps.length) return;

  steps[currentStep]();
  currentStep++;

  if (currentStep >= steps.length) {
    searchFinished = true;
    document.getElementById("nextBtn").disabled = true;
  }
}

/* ---------------- LINEAR SEARCH ---------------- */

function prepareLinear(target) {

  const code = [
"def linear_search(arr, target):",
"    for i in range(len(arr)):",
"        if arr[i] == target:",
"            return i",
"    return -1"
  ];

  setCode(code);
  traceHeader.innerHTML = "<th>Step</th><th>Index</th><th>Value</th><th>Match?</th>";

  steps.push(() => highlightLine(0));

  for (let i = 0; i < array.length; i++) {

    steps.push(() => {
      highlightLine(1);
      highlightBox(i, "current");
    });

    steps.push(() => highlightLine(2));

    steps.push(() => {
      const match = array[i] === target;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${i+1}</td>
        <td>${i}</td>
        <td>${array[i]}</td>
        <td>${match ? "‚úÖ" : "‚ùå"}</td>`;
      traceBody.appendChild(row);

      if (match) {
        highlightLine(3);
        highlightBox(i, "found");
        searchFinished = true;
      } else {
        highlightBox(i, "checked");
      }
    });

    if (array[i] === target) break;
  }

  steps.push(() => highlightLine(4));
}

/* ---------------- BINARY SEARCH ---------------- */

function prepareBinary(target) {

  const code = [
"def binary_search(arr, target):",
"    start = 0",
"    end = len(arr) - 1",
"    while start <= end:",
"        mid = (start + end) // 2",
"        if arr[mid] == target:",
"            return mid",
"        elif arr[mid] < target:",
"            start = mid + 1",
"        else:",
"            end = mid - 1",
"    return -1"
  ];

  setCode(code);

  traceHeader.innerHTML =
  "<th>Step</th><th>Start</th><th>End</th><th>Mid</th><th>Value</th><th>Action</th>";

  let start = 0;
  let end = array.length - 1;
  let step = 1;

  steps.push(() => highlightLine(0));
  steps.push(() => highlightLine(1));
  steps.push(() => highlightLine(2));

  while (start <= end) {

    const mid = Math.floor((start + end) / 2);
    const val = array[mid];

    steps.push(() => highlightLine(3));

    steps.push(() => {
      highlightLine(4);
      highlightBox(mid, "current");
      midInfo.style.display = "block";
      midInfo.innerHTML = `mid = (${start} + ${end}) // 2 = ${mid}`;
    });

    steps.push(() => highlightLine(5));

    steps.push(() => {
      let action;

      if (val === target) {
        highlightLine(6);
        highlightBox(mid, "found");
        action = "Found";
        searchFinished = true;
      } else if (val < target) {
        highlightLine(7);
        action = "Search Right";
        highlightBox(mid, "checked");
        start = mid + 1;
      } else {
        highlightLine(9);
        action = "Search Left";
        highlightBox(mid, "checked");
        end = mid - 1;
      }

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${step}</td>
        <td>${start}</td>
        <td>${end}</td>
        <td>${mid}</td>
        <td>${val}</td>
        <td>${action}</td>`;
      traceBody.appendChild(row);

      step++;
    });

    if (val === target) break;
  }

  steps.push(() => highlightLine(10));
}

renderArray();

</script>
<footer>
    ¬© <span id="year"></span> StudyHub CS
  </footer>


<script src="../js/booklets.js"></script>

</body>
</html>